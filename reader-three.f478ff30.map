{"version":3,"sources":["frog/reader-three.js"],"names":["console","log","THREE","WEBGL","isWebGLAvailable","document","body","appendChild","getWebGLErrorMessage","g_parts","push","g_parts_ref","g_controls","g_stats","g_headlight","g_camera","PerspectiveCamera","window","innerWidth","innerHeight","g_scene","Scene","g_renderer","WebGLRenderer","antialias","g_loader","STLLoader","g_material","MeshPhongMaterial","color","flatShading","side","DoubleSide","g_part","g_color","g_vehicle_ref_x","g_vehicle_ref_y","g_vehicle_ref_z","g_vehicle_dx","g_vehicle_dy","g_vehicle_dz","load_geom","name","file","load","geometry","computeBoundingBox","mesh","Mesh","add","view_scene","bbox","boundingBox","load_geom_ref","make_tires","compute_radii","make_wheels","i","vec","attributes","position","array","cnt","count","r","x","y","z","Math","sqrt","r_min","R","reduce","min","r_max","max","radii","map","geom","tire_lf","clone","tire_rf","tire_lr","tire_rr","init_tires","rotateX","degToRad","init_wheels","wheel_lf","wheel_rf","wheel_lr","wheel_rr","render","sceneBoundingBox","scene","bb","Box3","traverse","node","expandByObject","viewBoundingBox","box","camera","isEmpty","size","Vector3","getSize","ctr","getCenter","dir","getWorldDirection","fov","PI","distance","abs","length","sin","pos","multiplyScalar","copy","far","updateProjectionMatrix","init","setPixelRatio","devicePixelRatio","setSize","getElementById","domElement","TrackballControls","rotateSpeed","zoomSpeed","panSpeed","noZoom","noPan","staticMoving","dynamicDampingFactor","keys","addEventListener","background","Color","setRGB","DirectionalLight","light","AmbientLight","onWindowResize","aspect","handleResize","animate","requestAnimationFrame","update","create_checkboxes","parts","container","dl","createElement","id","dt","innerHTML","part","dd","checkbox","type","value","checked","onclick","data","visible","label","htmlFor","createTextNode","create_checkboxes_tires","create_checkboxes_wheels","create_color","slider","step","oninput","g","b","em","style"],"mappings":"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","file":"reader-three.f478ff30.map","sourceRoot":"..","sourcesContent":["// frog/reader.js\r\n\r\nconsole.log('Three-js included?', !!THREE);\r\n\r\nif( WEBGL.isWebGLAvailable() === false ) \r\n{\r\n  document.body.appendChild( WEBGL.getWebGLErrorMessage() );\r\n}\r\n\r\n// ----------------------------------------------------------------------------\r\n// parts to load\r\n// ----------------------------------------------------------------------------\r\n\r\nconst g_parts = []\r\n{\r\n  g_parts.push('body2')\r\n  g_parts.push('body')\r\n  /*\r\n  g_parts.push('glass')\r\n  g_parts.push('grill')\r\n  g_parts.push('interior')\r\n  g_parts.push('suspension')\r\n  g_parts.push('snorkle')\r\n  g_parts.push('nozzles')\r\n  g_parts.push('waterjet')\r\n  g_parts.push('exhaust')\r\n  g_parts.push('engine')\r\n  g_parts.push('brakes')\r\n  g_parts.push('tires')\r\n  g_parts.push('wheels')\r\n  */\r\n  g_parts.push('transmission')\r\n}\r\n\r\nconst g_parts_ref = []\r\n{\r\n  g_parts_ref.push('wheel-1')\r\n  g_parts_ref.push('tire-1')\r\n}\r\n\r\n// ----------------------------------------------------------------------------\r\n// main objects\r\n// ----------------------------------------------------------------------------\r\n\r\nconst g_camera   = new THREE.PerspectiveCamera( 40, window.innerWidth / window.innerHeight, 1, 1000 );\r\nconst g_scene    = new THREE.Scene();\r\nconst g_renderer = new THREE.WebGLRenderer( { antialias: true } );\r\nconst g_loader   = new THREE.STLLoader();\r\nvar   g_controls \r\nvar   g_stats\r\nvar   g_headlight\r\n\r\nconst g_material = new THREE.MeshPhongMaterial({ \r\n      color: 0x666666, \r\n      flatShading: false,\r\n      side: THREE.DoubleSide,\r\n});\r\n\r\nlet g_part = {}\r\n\r\nlet g_color = {}\r\ng_color.r = 0.2\r\ng_color.g = 0.3\r\ng_color.b = 0.4\r\n\r\nvar g_vehicle_ref_x = 12\r\nvar g_vehicle_ref_y = 1.5\r\nvar g_vehicle_ref_z = -49\r\nvar g_vehicle_dx    = 218\r\nvar g_vehicle_dy    = 150\r\nvar g_vehicle_dz    = 69/2.\r\n\r\nfunction load_geom( name )\r\n{\r\n  var file = \"data/\" + name + \".stl\"\r\n  g_loader.load(file, function (geometry) {\r\n    geometry.computeBoundingBox()\r\n    var mesh = new THREE.Mesh( geometry, g_material );\r\n    g_scene.add(mesh);\r\n    view_scene( g_scene )\r\n    g_part[name] = {}\r\n    g_part[name].mesh = mesh\r\n    g_part[name].bbox = geometry.boundingBox\r\n  });\r\n}\r\n\r\nfunction load_geom_ref( name )\r\n{\r\n  var file = \"data/\" + name + \".stl\"\r\n  g_loader.load(file, function (geometry) {\r\n    geometry.computeBoundingBox()\r\n    var mesh = new THREE.Mesh( geometry, g_material );\r\n    g_part[name] = {}\r\n    g_part[name].mesh = mesh\r\n    g_part[name].bbox = geometry.boundingBox\r\n    if( name === \"tire-1\" ) make_tires()\r\n    if( name === \"tire-1\" ) compute_radii('tire-1')\r\n    if( name === \"wheel-1\" ) make_wheels()\r\n  });\r\n}\r\n\r\nfunction compute_radii(name)\r\n{\r\n  vec = g_part[name].mesh.geometry.attributes.position.array\r\n  cnt = g_part[name].mesh.geometry.attributes.position.count\r\n  r = []\r\n  for( i=0; i < cnt; i++ ) \r\n  {\r\n    x = vec[i*3+0]\r\n    y = vec[i*3+1]\r\n    z = vec[i*3+2]\r\n    r.push( Math.sqrt( x*x + y*y ) )\r\n  }\r\n  r_min = R.reduce( R.min, +10000, r )\r\n  r_max = R.reduce( R.max, -10000, r )\r\n  g_part[name].radii = R.map( x => (x-r_min)/(r_max-r_min), r )\r\n}\r\n\r\nfunction make_tires()\r\n{\r\n  geom = g_part['tire-1'].mesh.geometry\r\n  var tire_lf = new THREE.Mesh( geom.clone(), g_material );\r\n  var tire_rf = new THREE.Mesh( geom.clone(), g_material );\r\n  var tire_lr = new THREE.Mesh( geom.clone(), g_material );\r\n  var tire_rr = new THREE.Mesh( geom.clone(), g_material );\r\n  g_scene.add(tire_lf);\r\n  g_scene.add(tire_rf);\r\n  g_scene.add(tire_lr);\r\n  g_scene.add(tire_rr);\r\n  g_part['tire_lf'] = {}\r\n  g_part['tire_rf'] = {}\r\n  g_part['tire_lr'] = {}\r\n  g_part['tire_rr'] = {}\r\n  g_part['tire_lf'].mesh = tire_lf\r\n  g_part['tire_rf'].mesh = tire_rf\r\n  g_part['tire_lr'].mesh = tire_lr\r\n  g_part['tire_rr'].mesh = tire_rr\r\n  init_tires()\r\n  view_scene( g_scene )\r\n}\r\n\r\nfunction init_tires()\r\n{\r\n  g_part['tire_lf'].mesh.geometry.rotateX( THREE.Math.degToRad(  90. ) )\r\n  g_part['tire_rf'].mesh.geometry.rotateX( THREE.Math.degToRad( -90 ) )\r\n  g_part['tire_lr'].mesh.geometry.rotateX( THREE.Math.degToRad(  90 ) )\r\n  g_part['tire_rr'].mesh.geometry.rotateX( THREE.Math.degToRad( -90 ) )\r\n\r\n  g_part['tire_lf'].mesh.position.x = g_vehicle_ref_x - g_vehicle_dx/2.\r\n  g_part['tire_lf'].mesh.position.y = g_vehicle_ref_y - g_vehicle_dy/2.\r\n  g_part['tire_lf'].mesh.position.z = g_vehicle_ref_z + g_vehicle_dz\r\n  g_part['tire_rf'].mesh.position.x = g_vehicle_ref_x - g_vehicle_dx/2.\r\n  g_part['tire_rf'].mesh.position.y = g_vehicle_ref_y + g_vehicle_dy/2.\r\n  g_part['tire_rf'].mesh.position.z = g_vehicle_ref_z + g_vehicle_dz\r\n  g_part['tire_lr'].mesh.position.x = g_vehicle_ref_x + g_vehicle_dx/2.\r\n  g_part['tire_lr'].mesh.position.y = g_vehicle_ref_y - g_vehicle_dy/2.\r\n  g_part['tire_lr'].mesh.position.z = g_vehicle_ref_z + g_vehicle_dz\r\n  g_part['tire_rr'].mesh.position.x = g_vehicle_ref_x + g_vehicle_dx/2.\r\n  g_part['tire_rr'].mesh.position.y = g_vehicle_ref_y + g_vehicle_dy/2.\r\n  g_part['tire_rr'].mesh.position.z = g_vehicle_ref_z + g_vehicle_dz\r\n}\r\n\r\nfunction init_wheels()\r\n{\r\n  g_part['wheel_lf'].mesh.geometry.rotateX( THREE.Math.degToRad(  90. ) )\r\n  g_part['wheel_rf'].mesh.geometry.rotateX( THREE.Math.degToRad( -90 ) )\r\n  g_part['wheel_lr'].mesh.geometry.rotateX( THREE.Math.degToRad(  90 ) )\r\n  g_part['wheel_rr'].mesh.geometry.rotateX( THREE.Math.degToRad( -90 ) )\r\n\r\n  g_part['wheel_lf'].mesh.position.x = g_vehicle_ref_x - g_vehicle_dx/2.\r\n  g_part['wheel_lf'].mesh.position.y = g_vehicle_ref_y - g_vehicle_dy/2.\r\n  g_part['wheel_lf'].mesh.position.z = g_vehicle_ref_z + g_vehicle_dz\r\n  g_part['wheel_rf'].mesh.position.x = g_vehicle_ref_x - g_vehicle_dx/2.\r\n  g_part['wheel_rf'].mesh.position.y = g_vehicle_ref_y + g_vehicle_dy/2.\r\n  g_part['wheel_rf'].mesh.position.z = g_vehicle_ref_z + g_vehicle_dz\r\n  g_part['wheel_lr'].mesh.position.x = g_vehicle_ref_x + g_vehicle_dx/2.\r\n  g_part['wheel_lr'].mesh.position.y = g_vehicle_ref_y - g_vehicle_dy/2.\r\n  g_part['wheel_lr'].mesh.position.z = g_vehicle_ref_z + g_vehicle_dz\r\n  g_part['wheel_rr'].mesh.position.x = g_vehicle_ref_x + g_vehicle_dx/2.\r\n  g_part['wheel_rr'].mesh.position.y = g_vehicle_ref_y + g_vehicle_dy/2.\r\n  g_part['wheel_rr'].mesh.position.z = g_vehicle_ref_z + g_vehicle_dz\r\n}\r\n\r\nfunction make_wheels()\r\n{\r\n  geom = g_part['wheel-1'].mesh.geometry\r\n  var wheel_lf = new THREE.Mesh( geom.clone(), g_material );\r\n  var wheel_rf = new THREE.Mesh( geom.clone(), g_material );\r\n  var wheel_lr = new THREE.Mesh( geom.clone(), g_material );\r\n  var wheel_rr = new THREE.Mesh( geom.clone(), g_material );\r\n  g_scene.add(wheel_lf);\r\n  g_scene.add(wheel_rf);\r\n  g_scene.add(wheel_lr);\r\n  g_scene.add(wheel_rr);\r\n  g_part['wheel_lf'] = {}\r\n  g_part['wheel_rf'] = {}\r\n  g_part['wheel_lr'] = {}\r\n  g_part['wheel_rr'] = {}\r\n  g_part['wheel_lf'].mesh = wheel_lf\r\n  g_part['wheel_rf'].mesh = wheel_rf\r\n  g_part['wheel_lr'].mesh = wheel_lr\r\n  g_part['wheel_rr'].mesh = wheel_rr\r\n  init_wheels()\r\n  view_scene( g_scene )\r\n  g_renderer.render( g_scene, g_camera );\r\n}\r\n\r\nfunction sceneBoundingBox( scene )\r\n{\r\n  var bb = new THREE.Box3()\r\n  g_scene.traverse( function( node ) {\r\n    if( node instanceof THREE.Mesh ) bb.expandByObject( node )\r\n  });\r\n  return bb;\r\n}\r\n\r\nfunction viewBoundingBox( box, camera )\r\n{\r\n  var verbose = 0\r\n  if( box.isEmpty() ) console.log(\"scene empty\")\r\n  if( box.isEmpty() ) return;\r\n  var size = new THREE.Vector3(); box.getSize(size)\r\n  var ctr  = new THREE.Vector3(); box.getCenter(ctr)\r\n  var dir  = new THREE.Vector3(); camera.getWorldDirection(dir)\r\n  if(verbose) console.log('bb:', box, box.getCenter( new THREE.Vector3() ) )\r\n  if(verbose) console.log('bb:', size )\r\n  var fov = camera.fov * ( Math.PI / 180 );\r\n  var distance = Math.abs( size.length() / Math.sin( fov / 2 ) );\r\n  distance *= 1.0\r\n  if(verbose) console.log('distance:', distance )\r\n  if(verbose) console.log('dir:', dir )\r\n  var pos = ctr.add( dir.multiplyScalar(-distance) )\r\n  if(verbose) console.log('cam.pos:', camera.position )\r\n  if(verbose) console.log('pos:', pos )\r\n  camera.position.copy(pos)\r\n  if(verbose) console.log('cam.pos:', camera.position )\r\n  if(verbose) console.log('far:', camera.far )\r\n  camera.far = 2*distance\r\n  if(verbose) console.log('far:', camera.far )\r\n  camera.updateProjectionMatrix()\r\n}\r\n\r\nfunction view_scene( scene )\r\n{\r\n  bb = sceneBoundingBox( scene )\r\n  viewBoundingBox( bb, g_camera )\r\n}\r\n\r\nfunction init() \r\n{\r\n  g_renderer.setPixelRatio( window.devicePixelRatio );\r\n  g_renderer.setSize( 0.65 *window.innerWidth, 0.65*window.innerHeight );\r\n  //document.body.appendChild( g_renderer.domElement );\r\n  document.getElementById(\"MyScene\").appendChild( g_renderer.domElement );\r\n\r\n  g_controls = new THREE.TrackballControls( g_camera, g_renderer.domElement );\r\n  g_controls.rotateSpeed = 2.5;\r\n  g_controls.zoomSpeed = -2.2;\r\n  g_controls.panSpeed = 0.8;\r\n  g_controls.noZoom = false;\r\n  g_controls.noPan = false;\r\n  g_controls.staticMoving = true;\r\n  g_controls.dynamicDampingFactor = 0.3;\r\n  g_controls.keys = [ 65, 83, 68 ];\r\n  g_controls.addEventListener( 'change', render );\r\n\r\n  g_scene.background = new THREE.Color( 0xcccccc );\r\n  g_scene.background = new THREE.Color( 0x000000 );\r\n  g_scene.background.setRGB(0.2,0.3,0.4)\r\n\r\n  for( i in g_parts ) load_geom( g_parts[i] )\r\n  for( i in g_parts_ref ) load_geom_ref( g_parts_ref[i] )\r\n\r\n  g_headlight = new THREE.DirectionalLight( 0xffffff );\r\n  g_headlight.position.copy( g_camera.position )\r\n  g_scene.add( g_headlight );\r\n\r\n  var light = new THREE.AmbientLight( 0xffffff );\r\n  g_scene.add( light );\r\n\r\n  //g_stats = new Stats();\r\n  //document.body.appendChild( g_stats.dom );\r\n\r\n  window.addEventListener( 'resize', onWindowResize, false );\r\n\r\n  render();\r\n}\r\n\r\nfunction onWindowResize() \r\n{\r\n  g_camera.aspect = window.innerWidth / window.innerHeight;\r\n  g_camera.updateProjectionMatrix();\r\n\r\n  g_renderer.setSize( 0.65*window.innerWidth, 0.65*window.innerHeight );\r\n\r\n  g_controls.handleResize();\r\n\r\n  render();\r\n}\r\n\r\nfunction animate() \r\n{\r\n  requestAnimationFrame( animate );\r\n  g_controls.update();\r\n}\r\n\r\nfunction render() \r\n{\r\n  g_headlight.position.copy( g_camera.position )\r\n  g_renderer.render( g_scene, g_camera );\r\n  //g_stats.update();\r\n}\r\n\r\n// ----------------------------------------------------------------------------\r\n// define gui controls\r\n// ----------------------------------------------------------------------------\r\n\r\n/*\r\n <dl id=\"checkboxes1\">\r\n        <dt>same label or term</dt>\r\n        <dd><input type=\"checkbox\" id=\"chk1\" /><label for=\"chk1\">checkbox 1</label></dd>\r\n        <dd><input type=\"checkbox\" id=\"chk2\" /><label for=\"chk2\">checkbox 2</label></dd>\r\n        <dd><input type=\"checkbox\" id=\"chk3\" /><label for=\"chk3\">checkbox 3</label></dd>\r\n        <dd><input type=\"checkbox\" id=\"chk4\" /><label for=\"chk4\">checkbox 4</label></dd>\r\n  </dl>\r\n*/\r\nfunction create_checkboxes(parts) \r\n{\r\n  var container = document.getElementById('checkboxes');\r\n  var dl = document.createElement('dl');\r\n      dl.id = \"checkboxes_dl\"\r\n\r\n  var dt = document.createElement('dt')\r\n      dt.innerHTML = \"Part visibility\"\r\n\r\n  dl.appendChild(dt)\r\n\r\n  for (var i = 0; i < parts.length; i++) \r\n  {\r\n    var part = parts[i];\r\n    console.log(part);\r\n\r\n    var dd = document.createElement('dd')\r\n\r\n    var checkbox = document.createElement('input');\r\n        checkbox.type = \"checkbox\";\r\n        checkbox.id = \"chk\" + parts[i]\r\n        checkbox.name = \"chk\" + parts[i]\r\n        checkbox.value = \"value\";\r\n        checkbox.checked = true;\r\n        checkbox.onclick = function(data) \r\n        {\r\n          return function() \r\n          { \r\n            //console.log(data); \r\n            checked = document.getElementById(\"chk\"+data).checked\r\n            g_part[data].mesh.visible = checked\r\n            g_renderer.render( g_scene, g_camera );\r\n          };\r\n        }(part)\r\n\r\n    var label = document.createElement('label')\r\n        label.htmlFor = \"chk\" + parts[i]\r\n        label.appendChild(document.createTextNode(parts[i]));\r\n\r\n    dd.appendChild(checkbox)\r\n    dd.appendChild(label)\r\n    dl.appendChild(dd)\r\n  }\r\n  container.appendChild(dl);\r\n}\r\n\r\nfunction create_checkboxes_tires() \r\n{\r\n    var dl = document.getElementById('checkboxes_dl');\r\n\r\n    var dd = document.createElement('dd')\r\n\r\n    var checkbox = document.createElement('input');\r\n        checkbox.type = \"checkbox\";\r\n        checkbox.id = \"chk_tires\"\r\n        checkbox.name = \"chk_tires\"\r\n        checkbox.value = \"value\";\r\n        checkbox.checked = true;\r\n        checkbox.onclick = function() \r\n        { \r\n          checked = document.getElementById(\"chk_tires\").checked\r\n          g_part['tire_lf'].mesh.visible = checked\r\n          g_part['tire_rf'].mesh.visible = checked\r\n          g_part['tire_lr'].mesh.visible = checked\r\n          g_part['tire_rr'].mesh.visible = checked\r\n          g_renderer.render( g_scene, g_camera );\r\n        };\r\n\r\n    var label = document.createElement('label')\r\n        label.htmlFor = \"chk_tires\"\r\n        label.appendChild(document.createTextNode(\"tires\"));\r\n\r\n    dd.appendChild(checkbox)\r\n    dd.appendChild(label)\r\n    dl.appendChild(dd)\r\n}\r\n\r\nfunction create_checkboxes_wheels() \r\n{\r\n    var dl = document.getElementById('checkboxes_dl');\r\n\r\n    var dd = document.createElement('dd')\r\n\r\n    var checkbox = document.createElement('input');\r\n        checkbox.type = \"checkbox\";\r\n        checkbox.id = \"chk_wheels\"\r\n        checkbox.name = \"chk_wheels\"\r\n        checkbox.value = \"value\";\r\n        checkbox.checked = true;\r\n        checkbox.onclick = function() \r\n        { \r\n          checked = document.getElementById(\"chk_wheels\").checked\r\n          g_part['wheel_lf'].mesh.visible = checked\r\n          g_part['wheel_rf'].mesh.visible = checked\r\n          g_part['wheel_lr'].mesh.visible = checked\r\n          g_part['wheel_rr'].mesh.visible = checked\r\n          g_renderer.render( g_scene, g_camera );\r\n        };\r\n\r\n    var label = document.createElement('label')\r\n        label.htmlFor = \"chk_wheels\"\r\n        label.appendChild(document.createTextNode(\"wheels\"));\r\n\r\n    dd.appendChild(checkbox)\r\n    dd.appendChild(label)\r\n    dl.appendChild(dd)\r\n}\r\n\r\n/*\r\n<div>\r\n    <label for=\"color_g\">color_g:</label>\r\n    <input type =\"range\" min=\"0\" max=\"1\" step=\"0.1\" value=\"0.3\"\r\n        oninput=\r\n        \"\r\n          color_g = this.value;\r\n          document.getElementById('color_g_label').innerHTML = color_g;\r\n          g_scene.background.setRGB(color_r, color_g, color_b );\r\n          g_renderer.render( g_scene, g_camera );\r\n        \"\r\n        name=\"color_g\" id=\"color_g\">\r\n    </input>\r\n    <em id=\"color_g_label\" style=\"font-style: normal;\"></em>\r\n</div>\r\n*/\r\nfunction create_color(x,value) \r\n{\r\n  var name = 'color_' + x\r\n  console.log( name )\r\n  var container = document.getElementById(name);\r\n\r\n  var label = document.createElement('label')\r\n      label.innerHTML = name + \":\"\r\n\r\n  var slider = document.createElement('input');\r\n      slider.type = 'range'\r\n      slider.min = '0'\r\n      slider.max = '1'\r\n      slider.step = '0.1'\r\n      slider.value = value\r\n      slider.oninput = function() \r\n      { \r\n        g_color[x] = this.value;\r\n        document.getElementById(name+'_label').innerHTML = g_color[x];\r\n        g_scene.background.setRGB(g_color.r, g_color.g, g_color.b );\r\n        g_renderer.render( g_scene, g_camera );\r\n      }\r\n\r\n  var em = document.createElement('em');\r\n      em.id = name + \"_label\"\r\n      em.style = \"font-style: normal\"\r\n      em.innerHTML = value\r\n\r\n  container.appendChild(label);\r\n  container.appendChild(slider);\r\n  container.appendChild(em);\r\n}\r\n\r\n\r\n// ----------------------------------------------------------------------------\r\n// create elements\r\n// ----------------------------------------------------------------------------\r\n\r\ncreate_checkboxes(g_parts)\r\ncreate_checkboxes_wheels()\r\ncreate_checkboxes_tires()\r\ncreate_color('r',g_color.r)\r\ncreate_color('g',g_color.g)\r\ncreate_color('b',g_color.b)\r\ninit();\r\nanimate();\r\n"]}